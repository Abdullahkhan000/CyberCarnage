{% extends "data/base.html" %}

{% block title %}
CYBERCARNAGE | MAIN CATALOGUE
{% endblock %}

{% block content %}
<style>
@keyframes slideInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
.card-entry { animation: slideInUp 0.6s ease-out forwards; }

@keyframes borderPulse {
  0% { border-color: rgba(236,72,153,0.5); box-shadow: 0 0 10px rgba(236,72,153,0.4); }
  50% { border-color: rgba(255,255,255,0.8); box-shadow: 0 0 25px rgba(255,255,255,0.7); }
  100% { border-color: rgba(236,72,153,0.5); box-shadow: 0 0 10px rgba(236,72,153,0.4); }
}
.group:hover .pulsing-border { animation: borderPulse 0.5s infinite alternate; }

@keyframes dynamicPan { 0% { transform: scale(1.1) translateX(0); } 50% { transform: scale(1.05) translateX(-5%); } 100% { transform: scale(1.1) translateX(0); } }
.poster-move { animation: dynamicPan 20s linear infinite alternate; transform-origin: top left; }

select { background-color: rgba(0,0,0,0.7); color: white; appearance: none; cursor: pointer; }
select option { background-color: rgba(0,0,0,0.85); color: white; }

.page-btn { transition: all 0.3s; }
.page-btn:hover { transform: scale(1.05); }
.page-btn.active { background-color: #ec4899; color: white; }
.dots { color: #aaa; }

@keyframes marquee {
  0%   { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}
.animate-marquee {
  display: inline-block;
  animation: marquee 20s linear infinite;
}
</style>

<div class="relative z-10 container mx-auto px-4 py-12">

  {% if latest_game %}
  <div class="overflow-hidden rounded-2xl shadow-[0_0_20px_rgba(0,255,255,0.6)] mb-8 border border-cyan-500/50
            bg-gradient-to-r from-black/80 via-gray-900/70 to-black/80">
  <div class="inline-block animate-marquee whitespace-nowrap py-4 px-6">
    {% for game in latest_game %}
      {% with detail=game.details.first %}
        {% if detail %}
          <a href="{% url 'game_detail' detail.id game.slug %}"
             class="inline-block mr-6 px-5 py-2 bg-cyan-700/50 hover:bg-cyan-600/70 border border-pink-500/60
                    rounded-lg text-white font-bold tracking-wide uppercase shadow-[0_0_10px_rgba(236,72,153,0.7)]
                    transition-all transform hover:scale-105">
            âš¡ New Game Added: {{ game.game_name }} âš¡
          </a>
        {% endif %}
      {% endwith %}
    {% endfor %}
  </div>
  </div>

  {% endif %}

  {# --- MAIN HEADER --- #}
  <div class="text-center mb-16 border-b-2 border-cyan-500/30 pb-8">
    <h1 class="text-4xl sm:text-5xl md:text-8xl font-display font-black uppercase tracking-tight
               text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-500
               drop-shadow-[0_0_10px_rgba(236,72,153,0.5)] glitch-hover mb-4 break-words">
      MAIN CATALOGUE
    </h1>
    <p class="text-gray-400 mt-2 text-lg font-mono tracking-wide mb-6 break-words">
      Explore all <span class="text-pink-400">>> {{ page_obj.paginator.count }}</span> games in our records.
    </p>
    <a href="{% url 'AI_chat' %}" class="inline-block bg-cyan-400 hover:bg-cyan-500 text-black font-bold
               px-6 py-3 rounded-lg glitch-hover transition text-lg">
      ASK CYBERCARNAGE AI FOR GAME INFO
    </a>
  </div>

  {# --- FILTER FORM --- #}
  <form method="get"
        class="mb-4 pt-6 px-6 pb-0 bg-black/70 rounded-2xl border border-cyan-500/40 backdrop-blur-md
               grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 max-w-5xl mx-auto">

    <input type="text" name="name" value="{{ request.GET.name }}"
           placeholder="Game Name"
           class="px-4 py-3 bg-black/70 border border-cyan-400 rounded-xl text-white font-bold tracking-wide text-lg uppercase">

    <select name="series" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500/30 to-pink-500/30
         border border-cyan-400 rounded-xl text-white font-bold tracking-wide text-lg uppercase">
        <option value="">All Series</option>
        {% for s in series_list %}
          <option value="{{ s }}" {% if request.GET.series == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>

    <select name="developer" class="w-full px-4 py-3 bg-gradient-to-r from-pink-500/30 to-purple-500/30
           border border-cyan-400 rounded-xl text-white font-bold tracking-wide text-lg uppercase">
      <option value="">All Developers</option>
      {% for d in developer_list %}
        <option value="{{ d }}" {% if request.GET.developer == d %}selected{% endif %}>{{ d }}</option>
      {% endfor %}
    </select>

    <select name="platform" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500/30 to-pink-500/30
           border border-cyan-400 rounded-xl text-white font-bold tracking-wide text-lg uppercase">
      <option value="">All Platforms</option>
      {% for p in platform_list %}
        <option value="{{ p }}" {% if request.GET.platform == p %}selected{% endif %}>{{ p }}</option>
      {% endfor %}
    </select>

    <select name="year" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500/30 to-pink-500/30
           border border-cyan-400 rounded-xl text-white font-bold tracking-wide text-lg uppercase">
      <option value="">All Years</option>
      {% for y in year_list %}
        <option value="{{ y }}" {% if request.GET.year|stringformat:"s" == y|stringformat:"s" %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>

    <input type="text" name="steam"
           value="{{ request.GET.steam }}"
           placeholder="Steam AppID"
           class="px-4 py-3 bg-black/70 border border-cyan-400 rounded-xl text-white font-bold tracking-wide text-lg uppercase">

    <button type="submit"
              class="bg-gradient-to-r from-cyan-600 to-blue-600
                     hover:from-cyan-500 hover:to-blue-500
                     text-white font-bold px-8 py-3 rounded-xl uppercase
                     tracking-wider text-lg shadow-lg transition-all">
          Apply Filters
    </button>

    <a href="{% url 'home' %}"
       class="bg-gradient-to-r from-red-500 to-pink-500
              hover:from-red-600 hover:to-pink-600
              text-white font-bold px-8 py-3 rounded-xl uppercase
              tracking-wider text-lg shadow-lg transition-all
              inline-block text-center">
        Clear Filters
    </a>

    <div id="active-filters" class="mb-0 max-w-5xl mx-auto flex flex-wrap gap-2"></div>

    <div id="no-results" class="col-span-full flex flex-col items-center justify-center py-20 text-center text-gray-500 hidden">
      <div class="text-6xl mb-4 text-red-500 animate-pulse-slow">ðŸ›‘</div>
      <h3 class="text-2xl font-display font-bold">NO MATCHING RESULTS FOUND</h3>
      <p class="text-gray-600 font-mono mt-2">TRY ADJUSTING OR CLEARING THE FILTERS.</p>
    </div>

  </form>

  {# --- GAME CARDS --- #}
  <div id="cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
    {% for game in page_obj %}
      {% with detail=game.details.first %}
      <div class="group relative bg-cyber-gray/60 backdrop-blur-md rounded-xl border border-gray-700/50
                  overflow-hidden hover:-translate-y-2 hover:shadow-[0_0_30px_rgba(236,72,153,0.4)]
                  transition-all duration-500 ease-out cursor-pointer card-entry"
           style="animation-delay: {{ forloop.counter }}00ms; opacity: 0;"
           data-game-name="{{ game.game_name|lower }}"
           data-series="{{ game.series|default_if_none:''|lower }}"
           data-company="{{ game.developer|lower }}"
           data-platform="{{ detail.platform|default_if_none:''|lower }}"
           data-year="{{ game.release_date|date:'Y' }}"
           data-steam-appid="{{ detail.steam_appid|default_if_none:'' }}">

        {% if detail %}
          <a href="{% url 'game_detail' detail.id detail.game.slug %}" class="absolute inset-0 z-30"></a>
        {% else %}
          <a class="absolute inset-0 z-30 cursor-not-allowed opacity-30" title="Details not added yet"></a>
        {% endif %}

        <div class="absolute inset-0 rounded-xl border-2 border-transparent group-hover:border-pink-500/50 transition-colors duration-300 pointer-events-none z-20 pulsing-border"></div>

        <div class="relative h-56 overflow-hidden">
          <div class="absolute inset-0 bg-gradient-to-t from-cyber-gray/90 via-transparent to-transparent z-10 opacity-80"></div>
          {% if detail and detail.poster %}
            <img src="{{ detail.poster }}" alt="{{ game.game_name }}" class="w-full h-full object-cover poster-move transition-transform duration-700 ease-in-out">
          {% else %}
            <div class="w-full h-full bg-gray-800 flex items-center justify-center text-gray-500 font-mono">NO POSTER</div>
          {% endif %}
          {% if game.series %}
            <span class="absolute top-3 left-3 z-20 bg-black/70 backdrop-blur-sm border border-purple-500/50 text-purple-400 text-xs font-mono uppercase px-3 py-1 rounded-full shadow-lg">
              Series: {{ game.series }}
            </span>
          {% endif %}
        </div>

        <div class="p-5 relative z-20 -mt-10">
          <h3 class="text-2xl font-display font-bold text-white leading-tight drop-shadow-lg group-hover:text-pink-300 transition-colors animate-float">
            {{ game.game_name }}
          </h3>

          <div class="h-px w-full bg-gradient-to-r from-gray-700 via-gray-500 to-gray-700 my-4 opacity-50"></div>

          <div class="space-y-2 text-sm font-mono">
            <p class="flex justify-between items-center text-gray-400">
              <span class="text-xs uppercase tracking-wider">DEV. UNIT:</span>
              <span class="text-cyan-400 font-semibold">{{ game.developer }}</span>
            </p>
            <p class="flex justify-between items-center text-gray-400">
              <span class="text-xs uppercase tracking-wider">INIT. DATE:</span>
              <span class="text-purple-400 font-semibold">{{ game.release_date }}</span>
            </p>
            <p class="flex justify-between items-center text-gray-400">
              <span class="text-xs uppercase tracking-wider">STEAM ID:</span>
              <span class="text-green-400 font-semibold ml-10">{{ detail.steam_appid }}</span>
            </p>
          </div>

          <div class="text-center mt-6">
            {% if detail %}
              <a href="{% url 'game_detail' detail.id detail.game.slug %}">
                <span class="relative inline-block text-sm font-bold text-pink-500 border-b border-pink-500 opacity-80 group-hover:opacity-100 group-hover:text-white group-hover:border-white transition-all duration-300 glitch-hover">
                  [ VIEW DATA FILE ]
                </span>
              </a>
            {% else %}
              <span class="relative inline-block text-sm font-bold text-gray-600 border-b border-gray-600 opacity-50 cursor-not-allowed" title="Details not added yet">
                [ NO DATA FILE ]
              </span>
            {% endif %}
          </div>
        </div>
      </div>
      {% endwith %}
    {% endfor %}
  </div>

  {# --- PAGINATION --- #}
  <div class="mt-10 flex justify-center gap-2">
    {% if page_obj.has_previous %}
      <a href="?{{ request.GET.urlencode }}&page={{ page_obj.previous_page_number }}" class="px-4 py-2 bg-cyan-400 rounded text-black">Prev</a>
    {% endif %}

    <span class="px-4 py-2 bg-pink-500 text-white rounded">{{ page_obj.number }}</span>

    {% if page_obj.has_next %}
      <a href="?{{ request.GET.urlencode }}&page={{ page_obj.next_page_number }}" class="px-4 py-2 bg-cyan-400 rounded text-black">Next</a>
    {% endif %}
  </div>

</div>
{% endblock %}
